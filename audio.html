
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Audio HTML</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4 sm:p-6">

    <div class="bg-white rounded-xl shadow-2xl p-6 sm:p-8 w-full max-w-xl text-center">
        <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-900 mb-4">
            ¡Hola! Aquí tienes un reproductor de audio
        </h1>
        <p class="text-gray-600 mb-6">
            Usa los controles para reproducir el archivo de sonido.
        </p>

        <!--
            La etiqueta <audio> es para incrustar audio.
            Atributos clave:
            - src: La ruta al archivo de audio.
            - controls: Añade los controles de reproducción (reproducir, pausar, volumen, etc.).
            - Si el navegador no puede reproducir el formato, se muestra el texto dentro de la etiqueta.
        -->
        <div class="my-8 flex justify-center">
            <audio controls class="w-full max-w-md bg-gray-100 rounded-lg p-3 shadow-md">
                <!--
                    Aquí se usa una ruta relativa que asume que tienes una carpeta 'assets'
                    en el mismo nivel que este archivo, y dentro un archivo de audio llamado 'musica_ejemplo.mp3'.
                    ¡Asegúrate de cambiar esta ruta por la de tu archivo real!
                -->
                <source src="./assets/musica_ejemplo.mp3" type="audio/mpeg">
                Tu navegador no soporta la etiqueta de audio.
            </audio>
        </div>

        <p class="text-sm text-gray-400 mt-8">
            Para que funcione, debes colocar tu archivo de audio en la ruta correcta.<br>Por ejemplo: `/tu_proyecto/assets/musica_ejemplo.mp3`
        </p>
    </div>
    <!--
</body>
</html>
<!DOCTYPE html>
<html>

<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title></title>
</head>

<body>
        
</body>

</html>
-->
<script>

/* eslint-disable */
(function (window, document) {

  const audioCtxList = [];
  // 创建一个新的 AudioContext 构造函数
  var AudioContext = window.AudioContext || window.webkitAudioContext || window.mozAudioContext;
  // 保存原始的 AudioContext 构造函数
  const origAudioContext = AudioContext;
  // 重写 AudioContext 构造函数
  Object.defineProperty(window, 'AudioContext', {
    get: function () {
      return function () {
        console.log("mv create audio context")
        // 创建原始的 AudioContext 实例
        var audioCtx = new origAudioContext();
        // 拦截原始的 AudioContext 实例的方法
        // var origSuspend = audioCtx.suspend;
        var origResume = audioCtx.resume;
        // 如果游戏未启动，则暂停音频, 并保存到列表中; 如果游戏是启动状态，则不暂停音频
        if (!window.isGameStarted) {
          audioCtx.suspend();
          audioCtxList.push(audioCtx);
        }
        var resolve;
        const promise = new Promise(r => resolve = r);
        audioCtx.resume = function () {
          // 在启动完成后恢复音频播放
          if (!window.isGameStarted)
            return promise;
          if (resolve) {
            resolve();
            resolve = null;
          }
          return origResume.call(this);
        }
        return audioCtx;
      }
    },
    set: function (v) {
      console.warn("mv AudioContext can not be setter.");
    }
  });

  function gameStartCheck() {
    window.isGameStarted = true;
    for (const audioCtx of audioCtxList) {
      if (audioCtx != null && audioCtx.state == "suspended")
        audioCtx.resume();
    }
    audioCtxList.length = 0;
  }

  if (typeof window.MW_gameStartCheck === 'undefined') {
    window.MW_gameStartCheck = gameStartCheck
  } else {
    console.warn('window.MW_gameStartCheck 不为空')
  }


  return gameStartCheck
})(window, document)

